import{c as Re,j as e,n as Oe,m as Te,r as n,s as m,B as I,L as ce,o as Fe,u as Ue,p as qe}from"./index-DZwxJa6p.js";import{D as Ve,d as Be,e as Le,f as Me,g as ze,H as be,h as ie,F as we,c as Xe,U as Qe,B as Ge}from"./Footer-C1KMTEGG.js";import{I as se}from"./input-DDQYHuv2.js";import{C as je,a as $e,b as De,c as Ae,d as Ee}from"./card-BXzsGqNW.js";import{S as ke}from"./separator-B9-gem9b.js";import{P as He,C as Ze}from"./progress-B-3pGF9K.js";import{C as Je}from"./circle-check-big-BvXSq9ye.js";import{C as Ne}from"./clock-oaySqPQl.js";import{u as _e}from"./useCourseAccess-CMuZGZRR.js";import{L as le}from"./label-D0JfEdvX.js";import{C as de}from"./circle-check-ByrmEm5X.js";import{D as Pe}from"./download-CPOnxjoA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=Re("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Ye=({totalLessons:t,completedLessons:O,className:u=""})=>{const $=t>0?Math.round(O/t*100):0,g=$===100;return e.jsxs("div",{className:`bg-card rounded-lg p-6 border border-border ${u}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g?e.jsx(Je,{className:"w-5 h-5 text-green-500"}):e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-semibold text-foreground",children:g?"Curso ConcluÃ­do!":"Progresso do Curso"})]}),e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[O," de ",t," aulas"]})]}),e.jsx(He,{value:$,className:"h-3 mb-2"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[$,"% completo"]}),g&&e.jsx("span",{className:"text-green-500 font-medium",children:"âœ“ Certificado disponÃ­vel"})]})]})},We=({courseId:t,courseTitle:O,amount:u,couponCode:$="",discountPercent:g=0,isOpen:y,onClose:he,onSuccess:_})=>{const{toast:p}=Oe(),{user:f}=Te(),{saveOptimisticAccess:s}=_e(t),[me,E]=n.useState(!1),[v,Q]=n.useState({email:"",name:"",phone:"",taxId:""}),[W,ne]=n.useState(null),[U,K]=n.useState(null),[l,h]=n.useState("pending"),[H,G]=n.useState(null),[i,R]=n.useState(null),[D,B]=n.useState(null),[q,Y]=n.useState(0),[V,k]=n.useState(null),[T,ue]=n.useState(null),[ee,ae]=n.useState(!1),[ve,ye]=n.useState(($||"").toUpperCase()),[ge,Ce]=n.useState(g||0),[Z,pe]=n.useState((g||0)>0),[Se,a]=n.useState(!1),[N,L]=n.useState(!0);n.useEffect(()=>{if(!y||!T||!f)return;console.log("ğŸ”” Configurando realtime para purchaseId:",T);const d=m.channel(`purchase_${T}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"course_purchases",filter:`id=eq.${T}`},async o=>{console.log("ğŸ”” Realtime purchase update:",o),o.new.payment_status==="approved"&&(console.log("âœ… Pagamento aprovado via realtime!"),h("verifying"),await C()&&(s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:"Redirecionando para o curso...",className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),500)))}).subscribe(),c=m.channel(`enrollment_${f.id}_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"course_enrollments",filter:`user_id=eq.${f.id}`},async o=>{console.log("ğŸ”” Realtime enrollment insert:",o),o.new.course_id===t&&(console.log("âœ… MatrÃ­cula criada via realtime!"),s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:"Redirecionando para o curso...",className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),500))}).subscribe();return()=>{console.log("ğŸ”• Removendo subscriptions realtime"),m.removeChannel(d),m.removeChannel(c)}},[y,T,f,t,_,p]),n.useEffect(()=>{if(!y||i!=="pix"||!U||l==="paid"||l==="verifying"||l==="checking")return;console.log("â±ï¸ Iniciando fallback de verificaÃ§Ã£o em 30s (PIX)...");const d=setTimeout(()=>{console.log("ğŸ”„ Iniciando verificaÃ§Ã£o de fallback (PIX) apÃ³s 30s"),h("checking"),k(Date.now())},3e4);return()=>clearTimeout(d)},[y,i,U,l]),n.useEffect(()=>{y&&(async()=>{const{data:{user:c}}=await m.auth.getUser();c!=null&&c.email&&Q(o=>({...o,email:c.email||""}))})()},[y]);const C=async(d=10)=>{const{data:{user:c}}=await m.auth.getUser();if(!c)return!1;for(let o=0;o<d;o++)try{const{data:x,error:j}=await m.from("course_enrollments").select("id").eq("user_id",c.id).eq("course_id",t).maybeSingle();if(j){console.error("âŒ Erro ao verificar matrÃ­cula:",j),await new Promise(F=>setTimeout(F,1e3));continue}if(x)return console.log("âœ… MatrÃ­cula confirmada!"),!0;console.log(`ğŸ”„ Tentativa ${o+1}/${d} - Aguardando criaÃ§Ã£o da matrÃ­cula...`),await new Promise(F=>setTimeout(F,1e3))}catch(x){console.error("âŒ Erro ao verificar matrÃ­cula:",x),await new Promise(j=>setTimeout(j,1e3))}return!1},A=async d=>{try{const{data:c,error:o}=await m.functions.invoke("check-purchase-status",{body:{purchaseId:d}});return o?(console.error("Erro ao verificar status da compra:",o),null):c}catch(c){return console.error("Erro ao verificar status da compra:",c),null}};n.useEffect(()=>{if(l!=="checking"||!T||!y)return;if(!V){const j=Date.now();k(j),console.log(`â±ï¸ [${new Date().toISOString()}] Iniciando polling de pagamento`)}const d=3e3,c=60*1e3,o=async()=>{try{const j=q+1,F=Date.now(),z=V?Math.round((F-V)/1e3):0;if(Y(j),console.log(`â±ï¸ [${new Date().toISOString()}] Tentativa ${j} (${z}s decorridos)`),V&&F-V>c){console.log(`â±ï¸ [${new Date().toISOString()}] âŒ Timeout: 60 segundos excedidos`),h("timeout"),p({title:"Tempo esgotado",description:"O pagamento ainda nÃ£o foi confirmado em 60s. Tente novamente ou entre em contato.",variant:"destructive"});return}if(D){console.log(`ğŸ” [${new Date().toISOString()}] Verificando status no gateway: ${D}`);try{const{data:w,error:te}=await m.functions.invoke("abacatepay-check-status",{body:{billingId:D}});if(!te&&(w!=null&&w.success)){if(console.log(`ğŸ“Š [${new Date().toISOString()}] Status do gateway: ${w.status}`),w.status==="PAID"||w.status==="APPROVED"){console.log(`âœ… [${new Date().toISOString()}] Pagamento confirmado no gateway! Confirmando manualmente...`);const{data:J,error:xe}=await m.functions.invoke("confirm-purchase",{body:{externalId:H,billingId:D}});if(!xe&&(J!=null&&J.success)){console.log(`âœ… [${new Date().toISOString()}] ConfirmaÃ§Ã£o manual bem-sucedida. Tempo total: ${z}s`),h("verifying");const fe=new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=");if(fe.volume=.6,fe.play().catch(()=>{const r=new(window.AudioContext||window.webkitAudioContext),S=r.createOscillator(),oe=r.createGain();S.connect(oe),oe.connect(r.destination),S.frequency.setValueAtTime(523.25,r.currentTime),S.frequency.setValueAtTime(659.25,r.currentTime+.1),S.frequency.setValueAtTime(783.99,r.currentTime+.2),oe.gain.setValueAtTime(.3,r.currentTime),oe.gain.exponentialRampToValueAtTime(.01,r.currentTime+.5),S.start(r.currentTime),S.stop(r.currentTime+.5)}),await C()){s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:`Confirmado em ${z}s. Redirecionando...`,className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),i==="card"?500:1500);return}else p({title:"AtenÃ§Ã£o",description:"Pagamento confirmado, mas houve um problema ao criar sua matrÃ­cula. Entre em contato com o suporte.",variant:"destructive"})}else console.log(`âš ï¸ [${new Date().toISOString()}] ConfirmaÃ§Ã£o manual falhou, continuando polling...`)}else if(w.status==="EXPIRED"||w.status==="CANCELLED"){console.log(`âŒ [${new Date().toISOString()}] Pagamento expirado/cancelado no gateway`),h("timeout"),p({title:"Pagamento Expirado",description:"O tempo para pagamento expirou. Gere um novo QR Code.",variant:"destructive"});return}}}catch(w){console.error(`âš ï¸ [${new Date().toISOString()}] Erro ao verificar gateway:`,w)}}console.log(`ğŸ” [${new Date().toISOString()}] Verificando status no banco local...`);const X=await A(T);if(!X||!X.success){console.error(`âŒ [${new Date().toISOString()}] Erro ao verificar status da compra`);return}if(console.log(`ğŸ“Š [${new Date().toISOString()}] Status no banco: ${X.status}`),X.status==="PAID"||X.status==="APPROVED"){console.log(`âœ… [${new Date().toISOString()}] Pagamento confirmado no banco! Tempo total: ${z}s`),h("verifying");const w=new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=");if(w.volume=.6,w.play().catch(()=>{}),await C()){s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:`Confirmado em ${z}s. Redirecionando...`,className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),i==="card"?500:1500);return}}}catch(j){console.error(`âŒ [${new Date().toISOString()}] Erro ao verificar pagamento:`,j)}},x=setInterval(o,d);return o(),()=>clearInterval(x)},[T,l,y,q,V,_,p,t,i,D,H]),n.useEffect(()=>{if(l!=="checking"||!T||!y)return;const d=async()=>{if(!document.hidden&&i==="card"){if(console.log(`ğŸ‘ï¸ [${new Date().toISOString()}] Janela voltou ao foco - verificando pagamento...`),D){const{data:o}=await m.functions.invoke("abacatepay-check-status",{body:{billingId:D}});if(o!=null&&o.success&&(o.status==="PAID"||o.status==="APPROVED")){console.log(`âœ… [${new Date().toISOString()}] Pagamento confirmado ao voltar ao foco!`);const{data:x}=await m.functions.invoke("confirm-purchase",{body:{externalId:H,billingId:D}});x!=null&&x.success&&(h("verifying"),await C()&&(s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:"Redirecionando para o curso...",className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),500)));return}}const c=await A(T);c!=null&&c.success&&(c.status==="PAID"||c.status==="APPROVED")&&(console.log(`âœ… [${new Date().toISOString()}] Pagamento confirmado ao voltar ao foco!`),h("verifying"),await C()&&(s(t,f==null?void 0:f.id),h("paid"),p({title:"Pagamento Confirmado! ğŸ‰",description:"Redirecionando para o curso...",className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>_(),500)))}};return document.addEventListener("visibilitychange",d),()=>document.removeEventListener("visibilitychange",d)},[l,T,y,i,_,p,t,D,H]);const P=d=>{navigator.clipboard.writeText(d),p({title:"Copiado!",description:"CÃ³digo PIX copiado para a Ã¡rea de transferÃªncia."})},M=()=>i==="card"&&Z&&ge>0?u-u*ge/100:u,b=async(d,c=0)=>{if(d.preventDefault(),ee){console.log("âš ï¸ JÃ¡ estÃ¡ processando, ignorando clique duplicado");return}ae(!0),E(!0);try{const o=new Date().toISOString();console.log(`ğŸ§¾ [${o}] ========== INICIANDO CHECKOUT ==========`),console.log(`ğŸ“ [${o}] Dados:`,{courseId:t,amount:u,paymentMethod:i,retryCount:c}),console.log(`ğŸ“‹ [${o}] FormulÃ¡rio:`,v);const{data:{user:x}}=await m.auth.getUser();console.log(`ğŸ‘¤ [${o}] UsuÃ¡rio:`,{user:x});let j=x==null?void 0:x.id;x||(console.log("ğŸ‘¤ UsuÃ¡rio nÃ£o logado - conta serÃ¡ criada automaticamente"),j=`temp_${v.email.replace(/[^a-zA-Z0-9]/g,"_")}_${Date.now()}`);const F=`CURSO${Date.now()}${Math.random().toString(36).substr(2,9)}`.toUpperCase();G(F),console.log(`ğŸ”– [${new Date().toISOString()}] ExternalId gerado: ${F}`);const z=v.phone.replace(/\D/g,""),X=v.taxId.replace(/\D/g,"");if(z.length<10||z.length>11)throw new Error("Telefone deve ter 10 ou 11 dÃ­gitos (DDD + nÃºmero)");if(X.length!==11&&X.length!==14)throw new Error("CPF deve ter 11 dÃ­gitos ou CNPJ deve ter 14 dÃ­gitos");console.log(`ğŸ“ [${new Date().toISOString()}] Criando registro de compra via edge function...`);const{data:w,error:te}=await m.functions.invoke("create-purchase",{body:{userId:j,courseId:t,amount:u,externalId:F,paymentMethod:i||"pix",customerData:{name:v.name,email:v.email,phone:z,taxId:X}}});if(te)throw console.error(`âŒ [${new Date().toISOString()}] Erro ao criar registro de compra:`,te),new Error(`Erro ao registrar compra: ${te.message||"Tente novamente"}`);if(console.log(`âœ… [${new Date().toISOString()}] Compra registrada:`,w),!(w!=null&&w.success))throw console.error("âŒ Purchase data invÃ¡lida:",w),new Error("Falha ao criar registro de compra");const J=w.purchaseId;ue(J),console.log(`â¡ï¸ [${new Date().toISOString()}] Invocando funÃ§Ã£o abacatepay-payment`);const xe=window.location.origin;console.log(`ğŸŒ [${new Date().toISOString()}] App Origin: ${xe}`),console.log(`ğŸš€ [${new Date().toISOString()}] Invocando abacatepay-payment com dados:`,{externalId:F,courseId:t,userId:j,amount:M(),paymentMethod:i,methods:i==="card"?["CARD"]:["PIX"],coupon:i==="card"&&$?$:null});const fe=Date.now(),Ie=M(),{data:r,error:S}=await m.functions.invoke("abacatepay-payment",{body:{externalId:F,courseId:t,userId:j,amount:Ie,customerEmail:v.email,customerName:v.name,customerPhone:z,customerTaxId:X,methods:i==="card"?["CARD"]:["PIX"],appOrigin:xe,allowCoupons:i==="card"&&Z,coupons:i==="card"&&Z?[ve]:[]}}),oe=Date.now()-fe;if(console.log(`â¬…ï¸ [${new Date().toISOString()}] Resposta abacatepay-payment recebida em ${oe}ms:`,{data:r,error:S}),console.log(`ğŸ“Š [${new Date().toISOString()}] Tipo de data: ${typeof r}`),console.log(`ğŸ“Š [${new Date().toISOString()}] Tipo de error: ${typeof S}`),S){if(console.error(`âŒ [${new Date().toISOString()}] Erro capturado (error object):`,S),console.error(`âŒ [${new Date().toISOString()}] Erro mensagem:`,S.message),console.error(`âŒ [${new Date().toISOString()}] Erro stack:`,S.stack),c<2&&(S.message.includes("network")||S.message.includes("fetch")))return console.log(`ğŸ”„ [${new Date().toISOString()}] Tentando novamente (${c+1}/2)...`),p({title:"Tentando novamente...",description:`Tentativa ${c+1} de 2`}),await new Promise(re=>setTimeout(re,3e3)),b(d,c+1);throw new Error(`Falha ao criar cobranÃ§a: ${S.message||"Erro desconhecido"}`)}if(!r)throw console.error(`âŒ [${new Date().toISOString()}] Resposta vazia do abacatepay-payment`),console.error(`âŒ [${new Date().toISOString()}] Data Ã© null ou undefined:`,r),new Error("Resposta vazia ao criar cobranÃ§a");if(console.log(`ğŸ“¦ [${new Date().toISOString()}] Resposta completa do AbacatePay (stringified):`,JSON.stringify(r,null,2)),console.log(`âœ… [${new Date().toISOString()}] data.success: ${r.success}`),console.log(`âœ… [${new Date().toISOString()}] data.billingUrl: ${r.billingUrl}`),console.log(`âœ… [${new Date().toISOString()}] data.billingId: ${r.billingId}`),r.success===!1)throw console.error("âŒ Erro retornado pelo AbacatePay:",r.error),new Error(r.error||"Erro ao criar cobranÃ§a");if(r.success){if(ne(r.billingUrl),r.billingId)if(B(r.billingId),J){const{error:re}=await m.from("course_purchases").update({metadata:{...v,billingId:r.billingId}}).eq("id",J);re?console.warn("âš ï¸ Falha ao salvar billingId no metadata da compra:",re):console.log("âœ… billingId salvo no metadata (frontend)")}else console.warn("âš ï¸ createdPurchaseId ausente ao salvar metadata");if(i==="card"&&r.billingUrl)console.log(`ğŸ’³ [${new Date().toISOString()}] Abrindo URL de pagamento com cartÃ£o: ${r.billingUrl}`),window.open(r.billingUrl,"_blank"),p({title:"Complete o pagamento",description:"Aguarde a confirmaÃ§Ã£o automÃ¡tica apÃ³s pagar"}),h("checking"),k(Date.now()),console.log(`ğŸ’³ [${new Date().toISOString()}] CartÃ£o: iniciando verificaÃ§Ã£o automÃ¡tica (polling a cada 3s)`);else if(i==="pix"&&r.brCode&&r.brCodeBase64){console.log(`ğŸ¥ [${new Date().toISOString()}] PIX gerado com sucesso. BillingId: ${r.billingId}`);const re=r.brCodeBase64.startsWith("data:")?r.brCodeBase64:`data:image/png;base64,${r.brCodeBase64}`;K({brCode:r.brCode,brCodeBase64:re,billingId:r.billingId}),B(r.billingId),console.log(`ğŸ¥ [${new Date().toISOString()}] PIX: QR Code pronto. Aguardando pagamento via realtime...`),p({title:"QR Code gerado!",description:"Escaneie o cÃ³digo ou copie para pagar"})}}else throw new Error(r.error||"Erro ao gerar cobranÃ§a")}catch(o){console.error(`âŒ [${new Date().toISOString()}] ============ ERRO NO CHECKOUT ============`),console.error(`âŒ [${new Date().toISOString()}] Tipo do erro:`,typeof o),console.error(`âŒ [${new Date().toISOString()}] Erro completo:`,o),console.error(`âŒ [${new Date().toISOString()}] Erro mensagem:`,o==null?void 0:o.message),console.error(`âŒ [${new Date().toISOString()}] Erro stack:`,o==null?void 0:o.stack),console.error(`âŒ [${new Date().toISOString()}] ==========================================`);let x=(o==null?void 0:o.message)||(o==null?void 0:o.toString())||"Erro ao processar pagamento";console.error("ğŸ“‹ Mensagem de erro final:",x),x.includes("Unauthorized")?x="Erro de autenticaÃ§Ã£o com o gateway de pagamento. Por favor, contate o suporte.":x.includes("network")?x="Erro de conexÃ£o. Verifique sua internet e tente novamente.":x.includes("Falha ao criar cobranÃ§a")||x==="Erro ao processar pagamento"&&(x=`Erro ao processar pagamento. Detalhes: ${(o==null?void 0:o.name)||"Desconhecido"}`),p({title:"Erro no checkout",description:x,variant:"destructive"})}finally{E(!1),ae(!1)}};return e.jsx(Ve,{open:y,onOpenChange:d=>{d||(h("pending"),K(null),R(null),ne(null),G(null),B(null),Y(0),k(null),ue(null),ae(!1),Q({email:"",name:"",phone:"",taxId:""}),he())},children:e.jsxs(Be,{className:"sm:max-w-md",children:[e.jsxs(Le,{children:[e.jsx(Me,{className:l==="paid"?"text-green-600":l==="timeout"||l==="error"?"text-red-600":"text-foreground",children:l==="paid"?"âœ… Pagamento Confirmado!":l==="timeout"?"â±ï¸ Tempo Esgotado":l==="error"?"âŒ Erro na VerificaÃ§Ã£o":i?"Finalizar Compra":"Escolha a forma de pagamento"}),e.jsx(ze,{children:l==="paid"?"Seu curso foi liberado com sucesso!":l==="timeout"?"O pagamento nÃ£o foi confirmado em 5 minutos":l==="error"?"NÃ£o foi possÃ­vel verificar o status do pagamento":i?i==="pix"&&U?"Escaneie o QR Code ou copie o cÃ³digo PIX":"Complete os dados para finalizar":"Selecione como deseja pagar"})]}),!i&&l!=="paid"&&l!=="verifying"?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(I,{variant:"outline",className:"h-24 flex flex-col gap-2 hover:bg-blue-50 hover:border-blue-500 dark:hover:bg-blue-950/20 transition-all",onClick:()=>R("pix"),children:[e.jsx("span",{className:"text-2xl",children:"ğŸ“±"}),e.jsx("span",{className:"font-semibold",children:"PIX QR Code"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Pagamento instantÃ¢neo"})]}),e.jsxs(I,{variant:"outline",className:"h-24 flex flex-col gap-2 hover:bg-violet-50 hover:border-violet-500 dark:hover:bg-violet-950/20 transition-all",onClick:()=>R("card"),children:[e.jsx("span",{className:"text-2xl",children:"ğŸ’³"}),e.jsx("span",{className:"font-semibold",children:"CartÃ£o"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"CrÃ©dito ou dÃ©bito"})]})]})}):!U&&l!=="paid"&&l!=="verifying"&&l!=="checking"&&l!=="timeout"&&l!=="error"?e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[!f&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"â„¹ï¸ Primeira compra?"}),e.jsx("br",{}),"NÃ£o se preocupe! Ao finalizar o pagamento, criaremos sua conta automaticamente e vocÃª receberÃ¡ um email com os dados de acesso."]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"name",children:"Nome Completo *"}),e.jsx(se,{id:"name",type:"text",placeholder:"Seu nome completo",value:v.name,onChange:d=>Q({...v,name:d.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"email",children:"Email *"}),e.jsx(se,{id:"email",type:"email",placeholder:"seu@email.com",value:v.email,onChange:d=>Q({...v,email:d.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"phone",children:"Telefone (WhatsApp) *"}),e.jsx(se,{id:"phone",type:"tel",placeholder:"(11) 91234-5678",value:v.phone,onChange:d=>Q({...v,phone:d.target.value}),maxLength:15,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"taxId",children:"CPF/CNPJ *"}),e.jsx(se,{id:"taxId",type:"text",placeholder:"000.000.000-00",value:v.taxId,onChange:d=>Q({...v,taxId:d.target.value}),maxLength:18,required:!0})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-2 bg-muted/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:"MÃ©todo de pagamento:"}),e.jsx("span",{className:"text-sm font-semibold",children:i==="pix"?"PIX":i==="card"?"CartÃ£o":"NÃ£o selecionado"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsxs("span",{className:"font-medium text-sm",children:["Valor ",i==="pix"?"PIX":i==="card"&&$&&g>0?"com desconto":"total",":"]}),e.jsx("span",{className:"text-lg font-bold",children:i==="card"&&$&&g>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"line-through text-muted-foreground text-sm mr-2",children:["R$ ",u.toFixed(2)]}),e.jsxs("span",{className:"text-green-600",children:["R$ ",M().toFixed(2)]})]}):`R$ ${u.toFixed(2)}`})]}),i==="pix"&&$&&g>0&&e.jsxs("div",{className:"flex justify-between items-center pt-1 text-xs border-t",children:[e.jsx("span",{className:"text-muted-foreground",children:"ğŸ’¡ Com cartÃ£o seria:"}),e.jsxs("span",{className:"text-green-600 font-semibold",children:["R$ ",M().toFixed(2)," (",g,"% off)"]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-2 bg-muted/50",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Como funciona?"}),i==="pix"?e.jsxs("ol",{className:"text-sm text-muted-foreground space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:'Clique em "Gerar PIX"'}),e.jsx("li",{children:"Escaneie o QR Code ou copie o cÃ³digo"}),e.jsx("li",{children:"Pague no app do seu banco"}),e.jsx("li",{children:"Aguarde a confirmaÃ§Ã£o (automÃ¡tica)"})]}):e.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{className:"flex items-start gap-2",children:e.jsx("span",{children:'1. Clique em "Ir para Pagamento"'})}),e.jsx("p",{className:"flex items-start gap-2",children:e.jsx("span",{children:"2. Complete o pagamento na pÃ¡gina segura do AbacatePay"})}),e.jsx("p",{className:"flex items-start gap-2",children:e.jsx("span",{children:"3. Volte para esta pÃ¡gina (nÃ£o feche!)"})}),e.jsx("p",{className:"flex items-start gap-2",children:e.jsx("span",{children:"4. Aguarde a confirmaÃ§Ã£o automÃ¡tica (atÃ© 2 minutos)"})})]})]}),e.jsx(I,{type:"submit",className:`w-full ${i==="pix"?"bg-blue-600 hover:bg-blue-700":"bg-violet-600 hover:bg-violet-700"}`,disabled:me||ee,children:me||ee?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Processando..."]}):i==="pix"?"Gerar PIX":"Ir para Pagamento"}),e.jsx(I,{type:"button",variant:"ghost",className:"w-full",onClick:()=>R(null),children:"Voltar"})]}):l==="verifying"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[e.jsx(ce,{className:"h-20 w-20 text-primary animate-spin"}),e.jsx("p",{className:"text-center font-medium",children:"Verificando matrÃ­cula..."}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Aguarde enquanto confirmamos sua matrÃ­cula no curso."})]}):l==="paid"?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4 bg-green-50 dark:bg-green-950/20 rounded-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"h-20 w-20 text-green-600 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 h-20 w-20 bg-green-600 rounded-full opacity-20 animate-ping"})]}),e.jsx("p",{className:"text-center font-bold text-lg text-green-700 dark:text-green-400",children:"Pagamento Confirmado!"}),e.jsx("p",{className:"text-center text-muted-foreground",children:"Redirecionando para o curso..."})]}):l==="timeout"||l==="error"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4 bg-red-50 dark:bg-red-950/20 rounded-lg",children:[e.jsx("div",{className:"text-red-600 text-6xl",children:"âš ï¸"}),e.jsx("p",{className:"text-center font-bold text-lg text-red-700 dark:text-red-400",children:l==="timeout"?"Tempo Esgotado":"Erro na VerificaÃ§Ã£o"}),e.jsx("p",{className:"text-center text-sm text-muted-foreground max-w-md",children:l==="timeout"?"O pagamento nÃ£o foi confirmado em 5 minutos. Por favor, verifique se o pagamento foi realizado ou tente novamente.":"NÃ£o foi possÃ­vel verificar o status do pagamento. Por favor, entre em contato com o suporte."}),q>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total de tentativas: ",q]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{variant:"outline",className:"flex-1",onClick:()=>{h("pending"),K(null),R(null),ne(null),B(null),Y(0),k(null),ae(!1)},children:"Tentar Novamente"}),e.jsx(I,{variant:"default",className:"flex-1 bg-violet-600 hover:bg-violet-700",onClick:()=>window.open("/contact","_blank"),children:"Falar com Suporte"})]})]}):i==="pix"&&U?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("img",{src:U.brCodeBase64,alt:"QR Code PIX",className:"w-64 h-64"}),e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(le,{children:"CÃ³digo PIX (Copiar e Colar)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{value:U.brCode,readOnly:!0,className:"font-mono text-xs"}),e.jsx(I,{type:"button",variant:"outline",size:"icon",onClick:()=>P(U.brCode),children:e.jsx(Ke,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-2 bg-gradient-to-r from-violet-50 to-blue-50 dark:from-violet-950/20 dark:to-blue-950/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 animate-spin text-violet-600"}),e.jsx("p",{className:"font-medium text-sm text-violet-700 dark:text-violet-400",children:"Aguardando pagamento..."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assim que vocÃª pagar, confirmaremos automaticamente e liberaremos seu curso."}),q>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Verificando... (tentativa ",q,")"]})]}),W&&e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>window.open(W,"_blank"),children:"Abrir em nova aba"})]}):i==="card"&&l==="checking"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4 bg-gradient-to-br from-violet-50 via-blue-50 to-violet-50 dark:from-violet-950/20 dark:via-blue-950/20 dark:to-violet-950/20 rounded-lg",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"h-20 w-20 text-violet-600 animate-spin"}),e.jsx("div",{className:"absolute inset-0 h-20 w-20 bg-violet-600 rounded-full opacity-10 animate-ping"})]}),e.jsx("p",{className:"text-center font-bold text-lg text-violet-700 dark:text-violet-400",children:"Processando Pagamento"}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground max-w-md",children:["Complete o pagamento na aba do AbacatePay.",e.jsx("strong",{className:"block mt-2 text-foreground",children:"Ao finalizar, vocÃª serÃ¡ redirecionado automaticamente!"})]}),q>0&&V&&e.jsxs("div",{className:"text-center space-y-1",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Verificando... (tentativa ",q,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tempo decorrido: ",Math.floor((Date.now()-V)/1e3),"s / 300s"]})]})]}),W&&e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>window.open(W,"_blank"),children:"Reabrir pÃ¡gina de pagamento"}),e.jsx(I,{variant:"default",className:"w-full",onClick:async()=>{try{if(h("verifying"),D){const{data:c,error:o}=await m.functions.invoke("abacatepay-check-status",{body:{billingId:D}});if(console.log("ğŸ” Status no gateway:",c,o),o&&console.warn("Erro ao consultar gateway (seguindo sem travar):",o),c!=null&&c.success&&(c.status==="PAID"||c.status==="APPROVED")&&H){const{data:x,error:j}=await m.functions.invoke("confirm-purchase",{body:{externalId:H,billingId:D}});console.log("âœ… ConfirmaÃ§Ã£o manual:",x,j)}}await C(20)?(h("paid"),p({title:"Pagamento confirmado! ğŸ‰",description:"Redirecionando para o curso..."}),_()):(h("checking"),p({title:"Ainda nÃ£o confirmado",description:"Continuaremos verificando automaticamente..."}))}catch(d){console.error("Erro ao confirmar manualmente:",d),h("checking"),p({title:"Erro ao confirmar",description:"Tente novamente em alguns segundos.",variant:"destructive"})}},children:"JÃ¡ paguei - Verificar agora (nÃ£o abre nova aba)"})]}):null]})})},ua=()=>{const{courseId:t}=Fe(),O=Ue(),{user:u}=Te(),$=qe(),{toast:g}=Oe(),{isEnrolled:y,isLoading:he,verificationComplete:_,refreshCache:p,saveOptimisticAccess:f}=_e(t),[s,me]=n.useState(null),[E,v]=n.useState([]),[Q,W]=n.useState([]),[ne,U]=n.useState(!0),[K,l]=n.useState(!1),[h,H]=n.useState(null),[G,i]=n.useState(""),[R,D]=n.useState(!1),[B,q]=n.useState(0),[Y,V]=n.useState(!1),k=n.useCallback(async()=>{try{U(!0);const{data:a,error:N}=await m.from("courses").select("*").eq("id",t).single();if(N)throw N;me(a);const{data:L,error:C}=await m.from("lessons").select("*").eq("course_id",t).order("order_number",{ascending:!0});if(C)throw C;if(u){const{data:A}=await m.from("lesson_progress").select("lesson_id, completed").eq("user_id",u.id).in("lesson_id",L.map(b=>b.id)),P=new Map((A==null?void 0:A.map(b=>[b.lesson_id,b.completed]))||[]),M=L.map(b=>({...b,completed:P.get(b.id)||!1}));v(M)}else v(L);if(u&&y){const{data:A}=await m.from("course_materials").select("*").eq("course_id",t);W(A||[]);const{data:P}=await m.from("certificates").select("*").eq("user_id",u.id).eq("course_id",t).maybeSingle();P&&(l(!0),H(P))}}catch(a){g({title:"Erro ao carregar curso",description:a.message,variant:"destructive"})}finally{U(!1)}},[t,u,y,g]);n.useEffect(()=>{t&&k()},[t,k]),n.useEffect(()=>{new URLSearchParams($.search).get("checkout")==="1"&&s&&t&&s.price&&s.price>0&&O(`/checkout/${t}`)},[$.search,s,t,O]),n.useEffect(()=>{const a=new URLSearchParams($.search);if(a.get("payment")==="success"&&u&&t){console.log(`âœ… [${new Date().toISOString()}] Retorno do pagamento detectado`),f(t,u.id),p(),k(),g({title:"âœ… Pagamento confirmado!",description:"Seu curso estÃ¡ sendo liberado...",className:"bg-green-600 text-white border-green-700"});const N=a.get("ext");N&&(async()=>{try{console.log(`âš¡ [${new Date().toISOString()}] Confirmando compra pelo externalId: ${N}`),await m.functions.invoke("confirm-purchase",{body:{externalId:N}})}catch(b){console.warn(`âš ï¸ [${new Date().toISOString()}] NÃ£o foi possÃ­vel confirmar imediatamente:`,b)}})();const L=m.channel(`payment_success_${u.id}_${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"course_enrollments",filter:`user_id=eq.${u.id}`},async b=>{console.log(`ğŸ”” [${new Date().toISOString()}] Enrollment realtime:`,b),b.new.course_id===t&&(console.log(`âœ… [${new Date().toISOString()}] MatrÃ­cula confirmada via realtime!`),await p(),await k(),localStorage.removeItem("lastPaymentMethod"),localStorage.removeItem("lastExternalId"),O(`/curso/${t}`,{replace:!0}))}).subscribe();let C=0;const A=30,P=async()=>{if(!u)return!1;C++,console.log(`ğŸ”„ [${new Date().toISOString()}] Polling tentativa ${C}/${A}`),await p();const{data:b}=await m.from("course_enrollments").select("id").eq("user_id",u.id).eq("course_id",t).maybeSingle();return b?(console.log(`âœ… [${new Date().toISOString()}] MatrÃ­cula confirmada via polling!`),await k(),localStorage.removeItem("lastPaymentMethod"),localStorage.removeItem("lastExternalId"),O(`/curso/${t}`,{replace:!0}),!0):!1},M=setInterval(async()=>{const b=await P();(b||C>=A)&&(clearInterval(M),C>=A&&!b&&(console.log(`â±ï¸ [${new Date().toISOString()}] Timeout no polling de enrollment`),g({title:"VerificaÃ§Ã£o demorada",description:"A confirmaÃ§Ã£o estÃ¡ demorando. Por favor, recarregue a pÃ¡gina em alguns instantes.",variant:"destructive"})))},2e3);return setTimeout(()=>{clearInterval(M),m.removeChannel(L)},6e4),()=>{clearInterval(M),m.removeChannel(L)}}},[$.search,u,t,O,g,k,p,f]),n.useEffect(()=>{t&&u&&p()},[t,u,p]);const T=async()=>{if(!s||!s.price||s.price<=0){g({title:"AtenÃ§Ã£o",description:"Este curso requer pagamento para acessar.",variant:"destructive"});return}ee(!0)},[ue,ee]=n.useState(!1),ae=async()=>{console.log(`âœ… [${new Date().toISOString()}] handlePaymentSuccess chamado`),t&&u&&f(t,u.id),await p(),await k(),g({title:"âœ… Pagamento confirmado! ğŸ‰",description:"Redirecionando para a primeira aula...",className:"bg-green-600 text-white border-green-700"}),setTimeout(()=>{if(E.length>0){const a=E[0];O(`/curso/${t}/aula/${a.id}`)}else O(`/curso/${t}`,{replace:!0})},1500)},ve=()=>{if(E.length>0){const a=E.find(N=>!N.completed)||E[0];O(`/curso/${t}/aula/${a.id}`)}else g({title:"Nenhuma aula disponÃ­vel",description:"Este curso ainda nÃ£o possui aulas.",variant:"destructive"})},ye=async()=>{if(!(!u||!t))try{g({title:"Gerando certificado...",description:"Por favor, aguarde."});const{data:a,error:N}=await m.functions.invoke("generate-certificate",{body:{course_id:t,user_id:u.id}});if(N)throw N;if(a!=null&&a.certificate_url){const L=await fetch(a.certificate_url);if(!L.ok)throw new Error("Erro ao baixar certificado");const C=await L.blob(),A=window.URL.createObjectURL(C),P=document.createElement("a");P.href=A,P.download=a.certificate_filename||`Certificado - ${a.user_name||"Aluno"}.pdf`,document.body.appendChild(P),P.click(),document.body.removeChild(P),window.URL.revokeObjectURL(A),g({title:"Certificado baixado!",description:"O arquivo foi salvo no seu dispositivo."}),l(!0),await k()}else throw new Error("NÃ£o foi possÃ­vel obter o link do certificado.")}catch(a){console.error("Certificate download error:",a),g({title:"Erro ao gerar certificado",description:a.message||"Ocorreu um erro ao processar o certificado.",variant:"destructive"})}},ge=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(2)+" KB":(a/(1024*1024)).toFixed(2)+" MB",Ce=async()=>{if(!G.trim()){g({title:"Digite um cupom",variant:"destructive"});return}V(!0);try{const{data:a,error:N}=await m.functions.invoke("validate-coupon",{body:{code:G}});N||!a.valid?(g({title:"Cupom invÃ¡lido",description:(a==null?void 0:a.message)||"Cupom nÃ£o encontrado ou expirado",variant:"destructive"}),D(!1),q(0)):(g({title:"Cupom aplicado! ğŸ‰",description:`${a.discountPercent}% de desconto (somente para cartÃ£o)`,className:"bg-green-600 text-white"}),D(!0),q(a.discountPercent))}catch{g({title:"Erro ao validar cupom",description:"Tente novamente",variant:"destructive"})}finally{V(!1)}},Z=()=>s?R&&B>0?s.price-s.price*B/100:s.price:0;if(ne)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(be,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-12",children:[e.jsx(ie,{className:"w-full aspect-video rounded-lg"}),e.jsxs("div",{className:"flex flex-col justify-center space-y-4",children:[e.jsx(ie,{className:"h-8 w-24"}),e.jsx(ie,{className:"h-12 w-full"}),e.jsx(ie,{className:"h-20 w-full"}),e.jsx(ie,{className:"h-12 w-full"})]})]})}),e.jsx(we,{})]});if(!s)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(be,{}),e.jsxs("div",{className:"container mx-auto px-4 py-20 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Curso nÃ£o encontrado"}),e.jsx(I,{onClick:()=>O("/cursos"),children:"Ver todos os cursos"})]}),e.jsx(we,{})]});const pe=E.filter(a=>a.completed).length,Se=E.length>0?pe/E.length*100:0;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(be,{}),e.jsxs("main",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-12",children:[e.jsx("div",{children:s.thumbnail_url&&e.jsx("img",{src:s.thumbnail_url,alt:s.title,className:"w-full rounded-lg shadow-lg object-cover aspect-video"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[s.category&&e.jsx(Xe,{variant:"secondary",className:"w-fit mb-4",children:s.category}),e.jsx("h1",{className:"text-4xl font-bold mb-4",children:s.title}),e.jsx("p",{className:"text-muted-foreground text-lg mb-6",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[s.enrolled_students_count&&s.enrolled_students_count>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[s.enrolled_students_count.toLocaleString("pt-BR")," alunos matriculados"]})]}),s.duration_hours>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[s.duration_hours,"h de conteÃºdo"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[E.length," aulas"]})]})]}),!_||he?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-12 bg-muted animate-pulse rounded-lg"})]}):y?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ye,{totalLessons:E.length,completedLessons:pe}),Se===100&&e.jsx(je,{className:"bg-gradient-to-r from-green-500/10 to-emerald-500/10 border-green-500/20",children:e.jsx($e,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-8 h-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:K?"Certificado DisponÃ­vel!":"Curso Completo!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K?"Baixe seu certificado de conclusÃ£o":"Clique para gerar seu certificado"})]})]}),e.jsxs(I,{variant:"outline",className:"border-green-500 text-green-600 hover:bg-green-500 hover:text-white",onClick:ye,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),K?"Baixar":"Gerar"]})]})})}),e.jsxs(I,{size:"lg",className:"w-full",onClick:ve,children:[e.jsx(Ze,{className:"w-5 h-5 mr-2"}),pe>0?"Continuar Curso":"Iniciar Curso"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["ou R$ ",s.price.toFixed(2)," Ã  vista"]})}),e.jsxs("div",{className:"mt-4 p-4 border-2 border-primary rounded-xl bg-gradient-to-br from-primary/5 to-primary/10 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-2xl",children:"ğŸŸï¸"}),e.jsx("h3",{className:"font-bold text-lg text-primary",children:"Cupom de Desconto"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{placeholder:"Digite seu cupom aqui",value:G,onChange:a=>i(a.target.value.toUpperCase()),disabled:R||Y,className:"flex-1 border-2 border-primary/30 focus:border-primary font-medium"}),e.jsx(I,{onClick:Ce,disabled:Y||R||!G.trim(),className:"bg-primary hover:bg-primary/90 min-w-[100px]",children:Y?e.jsx(ce,{className:"w-4 h-4 animate-spin"}):R?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Aplicado"]}):"Aplicar"})]}),R&&e.jsx("div",{className:"mt-3 p-2 bg-green-50 dark:bg-green-950/30 border border-green-300 dark:border-green-700 rounded-md",children:e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-400 font-semibold flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),'Cupom "',G,'" aplicado! ',B,"% de desconto"]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 flex items-start gap-1",children:[e.jsx("span",{children:"ğŸ’³"}),e.jsx("span",{children:"Desconto vÃ¡lido apenas para pagamento com cartÃ£o de crÃ©dito ou dÃ©bito."})]})]}),R&&B>0&&e.jsxs("div",{className:"text-center py-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:["ğŸ’° R$ ",Z().toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-through mt-1",children:["De: R$ ",s.price.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-400 font-semibold mt-1",children:["VocÃª economiza R$ ",(s.price-Z()).toFixed(2)," com este cupom!"]})]}),e.jsx(I,{size:"lg",className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold text-lg py-6",onClick:T,children:s.price&&s.price>0?`COMPRE AGORA - R$ ${Z().toFixed(2)}`:"COMPRE AGORA"})]})]})]}),e.jsx(ke,{className:"my-12"}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"ConteÃºdo do Curso"}),e.jsx("div",{className:"space-y-3",children:E.map((a,N)=>e.jsx(je,{className:"hover:shadow-md transition-shadow",children:e.jsx(De,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"mt-1",children:a.completed?e.jsx(de,{className:"w-5 h-5 text-green-500"}):e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-muted-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(Ae,{className:"text-lg",children:[N+1,". ",a.title]}),a.description&&e.jsx(Ee,{className:"mt-1",children:a.description})]})]}),a.duration_minutes>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground whitespace-nowrap",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[a.duration_minutes," min"]})]})]})})},a.id))})]}),y&&Q.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"my-12"}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Materiais de Apoio"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:Q.map(a=>e.jsxs(je,{children:[e.jsxs(De,{children:[e.jsxs(Ae,{className:"text-lg flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-primary"}),a.title]}),e.jsxs(Ee,{className:"flex items-center gap-4",children:[a.file_type&&e.jsx("span",{className:"uppercase",children:a.file_type}),a.file_size&&e.jsx("span",{children:ge(a.file_size)})]})]}),e.jsx($e,{children:e.jsx(I,{variant:"outline",className:"w-full",onClick:()=>{if(!a.file_url){g({title:"Erro",description:"URL do material nÃ£o disponÃ­vel",variant:"destructive"});return}try{window.open(a.file_url,"_blank","noopener,noreferrer")}catch(N){console.error("Erro ao abrir material:",N),g({title:"Erro ao abrir material",description:"NÃ£o foi possÃ­vel abrir o material. Tente novamente.",variant:"destructive"})}},children:"Baixar Material"})})]},a.id))})]})]})]}),e.jsx(we,{}),e.jsx(We,{courseId:t||"",courseTitle:(s==null?void 0:s.title)||"",amount:Z(),couponCode:G,discountPercent:B,isOpen:ue,onClose:()=>ee(!1),onSuccess:ae})]})};export{ua as default};
