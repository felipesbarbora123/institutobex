import{c as te,u as oe,m as ie,n as ne,r as l,s as c,j as e,B as x}from"./index-DZwxJa6p.js";import{H as G,F as H,U as le,B as J,j as ce,k as de,l as me,c as ue}from"./Footer-C1KMTEGG.js";import{C as E,b as A,c as k,d as T,a as U}from"./card-BXzsGqNW.js";import{I as h}from"./input-DDQYHuv2.js";import{L as d}from"./label-D0JfEdvX.js";import{S as he}from"./separator-B9-gem9b.js";import{T as fe,a as pe,b as D,c as q}from"./tabs-6h0c_Wcz.js";import{L as xe}from"./lock-BqV1AFS9.js";import{o as V,Z as O,s as b}from"./types-CgaFKbNx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=te("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ge=V({first_name:b().trim().min(2,"Nome deve ter pelo menos 2 caracteres").max(50,"Nome muito longo"),last_name:b().trim().min(2,"Sobrenome deve ter pelo menos 2 caracteres").max(50,"Sobrenome muito longo")}),je=V({newPassword:b().min(5,"Senha deve ter pelo menos 5 caracteres").max(100),confirmPassword:b()}).refine(m=>m.newPassword===m.confirmPassword,{message:"As senhas não coincidem",path:["confirmPassword"]}),Ae=()=>{const m=oe(),{user:r,loading:y}=ie(),{toast:o}=ne(),[t,u]=l.useState({first_name:"",last_name:"",avatar_url:null}),[_,P]=l.useState("student"),[F,B]=l.useState([]),[Z,L]=l.useState(!0),[v,g]=l.useState(!1),[j,z]=l.useState(!1),[S,I]=l.useState(""),[M,$]=l.useState(""),[W,K]=l.useState("account");l.useEffect(()=>{if(!y){if(!r){m("/auth");return}Q()}},[r,y]);const Q=async()=>{if(r)try{L(!0);const{data:a,error:s}=await c.from("profiles").select("first_name, last_name, avatar_url").eq("id",r.id).maybeSingle();if(s)throw s;u(a||{first_name:"",last_name:"",avatar_url:null});const{data:i,error:n}=await c.from("user_roles").select("role").eq("user_id",r.id);if(n)throw n;if(i&&Array.isArray(i)&&i.length>0){const p=i.map(C=>C.role),w=p.includes("admin")?"admin":p.includes("teacher")?"teacher":"student";P(w)}else P("student");const{data:f}=await c.from("course_enrollments").select(`
          enrolled_at,
          courses (
            id,
            title,
            instructor_name,
            thumbnail_url
          )
        `).eq("user_id",r.id).order("enrolled_at",{ascending:!1});f&&B(f)}catch(a){console.error("Erro ao carregar perfil:",a),u({first_name:"",last_name:"",avatar_url:null}),_||P("student"),B([])}finally{L(!1)}},X=async a=>{if(a.preventDefault(),!!r)try{g(!0);const s=ge.parse(t),{error:i}=await c.from("profiles").update({first_name:s.first_name,last_name:s.last_name}).eq("id",r.id);if(i)throw i;o({title:"Perfil atualizado!",description:"Suas informações foram salvas com sucesso."})}catch(s){s instanceof O?o({title:"Erro de validação",description:s.errors[0].message,variant:"destructive"}):o({title:"Erro ao atualizar perfil",description:s.message,variant:"destructive"})}finally{g(!1)}},Y=async a=>{if(!r||!a.target.files||a.target.files.length===0)return;const s=a.target.files[0];if(!["image/png","image/jpeg","image/jpg"].includes(s.type)){o({title:"Arquivo inválido",description:"Por favor, selecione uma imagem PNG, JPG ou JPEG.",variant:"destructive"});return}if(s.size>5*1024*1024){o({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 5MB.",variant:"destructive"});return}try{z(!0),o({title:"Enviando foto...",description:"Por favor, aguarde."});const n=s.name.split(".").pop(),f=`${r.id}/${Date.now()}.${n}`;if(t.avatar_url)try{const N=t.avatar_url.split("/avatars/")[1];N&&await c.storage.from("avatars").remove([N])}catch(N){console.log("Erro ao deletar avatar antigo:",N)}const{error:p}=await c.storage.from("avatars").upload(f,s,{upsert:!0,cacheControl:"0"});if(p)throw p;const{data:{publicUrl:w}}=c.storage.from("avatars").getPublicUrl(f),C=`${w}?t=${Date.now()}`,{error:R}=await c.from("profiles").update({avatar_url:w}).eq("id",r.id);if(R)throw R;u({...t,avatar_url:C}),window.dispatchEvent(new Event("profileUpdated")),o({title:"Foto atualizada com sucesso!",description:"Sua foto de perfil foi alterada."})}catch(n){console.error("Erro no upload:",n),o({title:"Falha ao enviar a foto. Tente novamente.",description:n.message,variant:"destructive"})}finally{z(!1)}},ee=async a=>{a.preventDefault();try{g(!0),je.parse({newPassword:S,confirmPassword:M});const{error:s}=await c.auth.updateUser({password:S});if(s)throw s;I(""),$(""),o({title:"Senha alterada!",description:"Sua senha foi atualizada com sucesso."})}catch(s){s instanceof O?o({title:"Erro de validação",description:s.errors[0].message,variant:"destructive"}):o({title:"Erro ao alterar senha",description:s.message,variant:"destructive"})}finally{g(!1)}},ae=()=>{var i,n;const a=((i=t.first_name)==null?void 0:i.charAt(0))||"",s=((n=t.last_name)==null?void 0:n.charAt(0))||"";return(a+s).toUpperCase()||"U"},se=a=>{switch(a){case"admin":return"destructive";case"teacher":return"default";default:return"secondary"}},re=a=>{switch(a){case"admin":return"Administrador";case"teacher":return"Professor";default:return"Aluno"}};return Z||y?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(G,{}),e.jsx("div",{className:"container mx-auto px-4 py-20 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando perfil..."})}),e.jsx(H,{})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(G,{}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Meu Perfil"}),e.jsxs(fe,{value:W,onValueChange:a=>K(a),className:"space-y-6",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3 bg-muted",children:[e.jsxs(D,{value:"account",className:"data-[state=active]:bg-background",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Conta"]}),e.jsxs(D,{value:"security",className:"data-[state=active]:bg-background",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Segurança"]}),e.jsxs(D,{value:"courses",className:"data-[state=active]:bg-background",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Meus Cursos"]})]}),e.jsx(q,{value:"account",className:"space-y-6",children:e.jsxs(E,{children:[e.jsxs(A,{children:[e.jsx(k,{children:"Informações do Perfil"}),e.jsx(T,{children:"Atualize suas informações pessoais e foto de perfil"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(ce,{className:"w-24 h-24",children:[e.jsx(de,{src:t.avatar_url?`${t.avatar_url}?t=${Date.now()}`:void 0,alt:"Foto de perfil"}),e.jsx(me,{className:"text-2xl",children:ae()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{htmlFor:"avatar",className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(ve,{className:"w-4 h-4"}),j?"Enviando foto...":"Alterar foto de perfil"]})}),e.jsx(h,{id:"avatar",type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:Y,disabled:j,className:"hidden"}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=document.getElementById("avatar"))==null?void 0:a.click()},disabled:j,children:j?"Enviando...":"Escolher Imagem"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"PNG, JPG ou JPEG. Máximo 5MB."})]})]}),e.jsx(he,{}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"first_name",children:"Nome"}),e.jsx(h,{id:"first_name",value:t.first_name,onChange:a=>u({...t,first_name:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"last_name",children:"Sobrenome"}),e.jsx(h,{id:"last_name",value:t.last_name,onChange:a=>u({...t,last_name:a.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Email"}),e.jsx(h,{value:(r==null?void 0:r.email)||"",disabled:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O email não pode ser alterado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Função"}),e.jsx("div",{children:e.jsx(ue,{variant:se(_),children:re(_)})})]}),e.jsx(x,{type:"submit",disabled:v,children:v?"Salvando...":"Salvar Alterações"})]})]})]})}),e.jsx(q,{value:"security",children:e.jsxs(E,{children:[e.jsxs(A,{children:[e.jsx(k,{children:"Alterar Senha"}),e.jsx(T,{children:"Atualize sua senha para manter sua conta segura"})]}),e.jsx(U,{children:e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"newPassword",children:"Nova Senha"}),e.jsx(h,{id:"newPassword",type:"password",value:S,onChange:a=>I(a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",children:"Confirmar Nova Senha"}),e.jsx(h,{id:"confirmPassword",type:"password",value:M,onChange:a=>$(a.target.value),required:!0})]}),e.jsx(x,{type:"submit",disabled:v,children:v?"Alterando...":"Alterar Senha"})]})})]})}),e.jsx(q,{value:"courses",children:e.jsxs(E,{children:[e.jsxs(A,{children:[e.jsx(k,{children:"Cursos Matriculados"}),e.jsx(T,{children:"Histórico de todos os cursos em que você está inscrito"})]}),e.jsx(U,{children:F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Você ainda não está matriculado em nenhum curso"}),e.jsx(x,{onClick:()=>m("/cursos"),children:"Explorar Cursos"})]}):e.jsx("div",{className:"space-y-4",children:F.map(a=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>m(`/curso/${a.courses.id}`),children:[a.courses.thumbnail_url&&e.jsx("img",{src:a.courses.thumbnail_url,alt:a.courses.title,className:"w-20 h-20 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:a.courses.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.courses.instructor_name}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Matriculado em"," ",new Date(a.enrolled_at).toLocaleDateString("pt-BR")]})]}),e.jsx(x,{variant:"outline",children:"Continuar"})]},a.courses.id))})})]})})]})]})}),e.jsx(H,{})]})};export{Ae as default};
