import{c as L,r as a,l as U,m as G,u as Q,s as f,k as W,j as e,B as r,L as _}from"./index-DZwxJa6p.js";import{b as J,H as K,S as X,B as q,c as Y,C as Z,F as ee}from"./Footer-C1KMTEGG.js";import{C as se}from"./card-BXzsGqNW.js";import{T as ae,a as te,b as re,c as le}from"./tabs-6h0c_Wcz.js";import{I as ne}from"./input-DDQYHuv2.js";import{P as oe,S as ie,a as ce,b as de,c as ue,d as E}from"./select-BQTkODBU.js";import{u as me}from"./useCourseAccess-CMuZGZRR.js";import{C as xe}from"./clock-oaySqPQl.js";import{U as he}from"./users-CYgoScVk.js";import"./index-BdQq_4o_.js";import"./chevron-down-BMPktge0.js";import"./chevron-up-D0sK4MUF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=L("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=L("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=L("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function je(d,l=500){const[u,y]=a.useState(d);return a.useEffect(()=>{const g=setTimeout(()=>{y(d)},l);return()=>{clearTimeout(g)}},[d,l]),u}const Ae=()=>{const[d]=U(),l=d.get("categoria"),{data:u=["Todos"],isLoading:y}=J(),{enrolledCourses:g,isLoading:N}=me(),[n,T]=a.useState(l||"Todos"),[o,b]=a.useState("all"),[z,D]=a.useState([]),[F,A]=a.useState(!0),[B,ve]=a.useState(null),[P,w]=a.useState([]),[C,H]=a.useState(""),[m,M]=a.useState("recent"),[R,I]=a.useState(!1),{user:i}=G(),x=Q();a.useEffect(()=>{l&&u.includes(l)&&T(l)},[l,u]),a.useEffect(()=>{N||h(),i&&V()},[i,g,N]),a.useEffect(()=>{const s=()=>{h(),i&&V()};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[i]),a.useEffect(()=>{const s=f.channel("realtime-courses").on("postgres_changes",{event:"*",schema:"public",table:"courses"},()=>h()).on("postgres_changes",{event:"*",schema:"public",table:"course_materials"},()=>h()).on("postgres_changes",{event:"*",schema:"public",table:"course_enrollments"},()=>h()).subscribe();return()=>{f.removeChannel(s)}},[]);const V=async()=>{if(!i){w([]);return}const{data:s,error:t}=await f.from("user_roles").select("role").eq("user_id",i.id);if(t){console.error("Error fetching user roles:",t),w([]);return}s&&w(s.map(c=>c.role))},h=async()=>{A(!0);try{const{data:s,error:t}=await f.from("courses").select("*").order("created_at",{ascending:!1});if(t)throw t;const c=await Promise.all((s||[]).map(async k=>{const{count:O}=await f.from("course_materials").select("*",{count:"exact",head:!0}).eq("course_id",k.id);return{...k,materials_count:O||0,is_enrolled:g.includes(k.id)}}));D(c)}catch(s){console.error("Error fetching courses:",s),W.error("Erro ao carregar cursos")}finally{A(!1)}},$=async s=>{x(`/checkout/${s}`)},p=P.includes("admin"),j=P.includes("teacher"),S=je(C,300),v=a.useMemo(()=>z.filter(s=>{var t;if(n!=="Todos"&&s.category!==n||o==="90"&&s.duration_hours!==90||o==="120"&&s.duration_hours!==120)return!1;if(S){const c=S.toLowerCase();return s.title.toLowerCase().includes(c)||((t=s.description)==null?void 0:t.toLowerCase().includes(c))}return!0}).sort((s,t)=>m==="recent"?0:m==="duration"?(t.duration_hours||0)-(s.duration_hours||0):m==="popular"?(t.materials_count||0)-(s.materials_count||0):0),[z,n,o,S,m]);return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(K,{}),(p||j)&&e.jsx(r,{onClick:()=>x("/admin/curso/novo"),className:"fixed bottom-8 right-8 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all z-50",size:"icon",children:e.jsx(oe,{className:"h-6 w-6"})}),e.jsxs("main",{className:"pt-20",children:[e.jsx("section",{className:"py-8 bg-gradient-to-b from-primary/5 to-background",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-foreground",children:"CURSOS"})})})}),e.jsx("section",{className:"py-12",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"mb-8 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),e.jsx(ne,{type:"text",placeholder:"Buscar cursos por título, descrição ou instrutor...",value:C,onChange:s=>H(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ie,{value:m,onValueChange:s=>M(s),children:[e.jsx(ce,{className:"w-[180px]",children:e.jsx(de,{placeholder:"Ordenar por"})}),e.jsxs(ue,{children:[e.jsx(E,{value:"recent",children:"Mais recentes"}),e.jsx(E,{value:"popular",children:"Mais populares"}),e.jsx(E,{value:"duration",children:"Duração"})]})]}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>I(!R),className:R?"bg-primary text-primary-foreground":"",children:e.jsx(ge,{className:"w-5 h-5"})})]})]}),C&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[v.length," ",v.length===1?"curso encontrado":"cursos encontrados"]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap gap-2",children:[e.jsx(r,{variant:o==="all"?"default":"outline",onClick:()=>b("all"),size:"sm",children:"Todas as Durações"}),e.jsx(r,{variant:o==="90"?"default":"outline",onClick:()=>b("90"),size:"sm",children:"90 Horas"}),e.jsx(r,{variant:o==="120"?"default":"outline",onClick:()=>b("120"),size:"sm",children:"120 Horas"})]}),e.jsxs(ae,{value:n,onValueChange:T,className:"w-full",children:[e.jsx(te,{className:"inline-flex w-auto mx-auto h-12 bg-muted/50 mb-8 overflow-x-auto flex-wrap justify-center",children:y?e.jsx("div",{className:"px-4 py-2",children:e.jsx(_,{className:"w-4 h-4 animate-spin"})}):u.map(s=>e.jsx(re,{value:s,className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground whitespace-nowrap",children:s},s))}),e.jsx(le,{value:n,children:F?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx(_,{className:"w-8 h-8 animate-spin text-primary"})}):v.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(q,{className:"w-12 h-12 text-primary"})}),e.jsx("h3",{className:"text-2xl font-bold text-foreground mb-3",children:"Nenhum curso disponível"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:n==="Todos"?"Ainda não há cursos cadastrados. Volte em breve!":`Nenhum curso encontrado na categoria ${n}.`})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(s=>e.jsxs(se,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 flex flex-col h-full",children:[e.jsx("div",{className:"h-48 bg-gradient-card flex items-center justify-center bg-cover bg-center flex-shrink-0",style:s.thumbnail_url?{backgroundImage:`url(${s.thumbnail_url})`}:{},children:!s.thumbnail_url&&e.jsx(q,{className:"w-16 h-16 text-primary/30"})}),e.jsxs("div",{className:"p-6 flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.category&&e.jsx("span",{className:"text-xs bg-muted px-2 py-1 rounded text-muted-foreground",children:s.category}),(p||j)&&e.jsxs(Y,{variant:"outline",className:"gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),"Admin"]})]}),(p||j)&&e.jsx(r,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>x(`/admin/curso/${s.id}`),children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx("h3",{className:"text-xl font-bold text-foreground mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2 flex-grow",children:s.description||"Sem descrição disponível"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 mt-auto",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.duration_hours||0,"h"]})]}),s.enrolled_students_count&&s.enrolled_students_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.enrolled_students_count.toLocaleString("pt-BR")," alunos matriculados"]})]})]}),N?e.jsx("div",{className:"w-full h-10 bg-muted animate-pulse rounded-md"}):e.jsx(e.Fragment,{children:p||j?e.jsxs(r,{className:"w-full",variant:"outline",onClick:()=>x(`/admin/curso/${s.id}`),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Gerenciar Curso"]}):s.is_enrolled?e.jsx(r,{className:"w-full",onClick:()=>x(`/curso/${s.id}`),children:"Continuar Curso"}):e.jsx(r,{className:"w-full bg-green-600 hover:bg-green-700 text-white",onClick:()=>$(s.id),disabled:B===s.id,children:B===s.id?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2 animate-spin"}),"Comprando..."]}):"COMPRE AGORA"})})]})]},s.id))})})]})]})})]}),e.jsx(ee,{})]})};export{Ae as default};
