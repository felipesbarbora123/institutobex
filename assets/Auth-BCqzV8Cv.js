import{r as o,m as N,n as y,u as w,j as e,q as E,B as b,L as C,s as S}from"./index-DZwxJa6p.js";import{I as h}from"./input-DDQYHuv2.js";import{L as g}from"./label-D0JfEdvX.js";import{C as L,b as q,c as I,d as F,a as T}from"./card-BXzsGqNW.js";import{s as l,Z as k}from"./types-CgaFKbNx.js";const z=l().email("Email invÃ¡lido"),A=l().min(5,"Senha deve ter no mÃ­nimo 5 caracteres");l().min(2,"Nome deve ter no mÃ­nimo 2 caracteres").max(50,"Nome muito longo");function K(){const[n,d]=o.useState(!1),[r,f]=o.useState(""),[c,x]=o.useState(""),[B,D]=o.useState(""),[P,Z]=o.useState(""),{signIn:m}=N(),{toast:a}=y(),u=w(),v=async t=>{t.preventDefault(),d(!0);try{z.parse(r),A.parse(c);const{error:s}=await m(r,c);if(s)if(s.message.includes("Invalid login credentials")){console.log("ðŸ” Tentando criar conta de admin prÃ©-cadastrado...");try{const{data:i,error:p}=await S.functions.invoke("auto-create-admin",{body:{email:r.toLowerCase().trim()}});if(p)throw p;if(i!=null&&i.success){console.log("âœ… Conta criada automaticamente, fazendo login...");const{error:j}=await m(r,"123456");j?a({title:"Erro ao fazer login",description:"Conta criada mas falha no login. Tente novamente com senha 123456",variant:"destructive"}):(a({title:"Conta criada!",description:"VocÃª foi registrado como administrador. Por favor, altere sua senha."}),u("/alterar-senha-obrigatoria"));return}}catch(i){console.log("NÃ£o Ã© um admin prÃ©-cadastrado ou erro:",i)}a({title:"Erro ao entrar",description:"Email ou senha incorretos",variant:"destructive"})}else a({title:"Erro ao entrar",description:s.message,variant:"destructive"});else a({title:"Bem-vindo!",description:"Login realizado com sucesso"}),u("/")}catch(s){s instanceof k&&a({title:"Dados invÃ¡lidos",description:s.errors[0].message,variant:"destructive"})}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-primary/5 p-4",children:e.jsxs(L,{className:"w-full max-w-md",children:[e.jsxs(q,{className:"space-y-1",children:[e.jsx(I,{className:"text-2xl font-bold text-center",children:"Acesse sua conta"}),e.jsx(F,{className:"text-center",children:"FaÃ§a login para acessar seus cursos ou adquira um curso para criar uma conta automaticamente."})]}),e.jsx(T,{children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"signin-email",children:"Email"}),e.jsx(h,{id:"signin-email",type:"email",placeholder:"seu@email.com",value:r,onChange:t=>f(t.target.value),required:!0,disabled:n})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"signin-password",children:"Senha"}),e.jsx(h,{id:"signin-password",type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:c,onChange:t=>x(t.target.value),required:!0,disabled:n})]}),e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsx(E,{to:"/esqueci-senha",className:"text-primary hover:underline",children:"Esqueceu a senha?"})}),e.jsx(b,{type:"submit",className:"w-full",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Entrando..."]}):"Entrar"})]})})]})})}export{K as default};
